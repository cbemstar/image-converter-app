<!-- google-ads-rsa-preview/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Google Ads RSA Comprehensive Preview Tool</title>

  <!-- Google Tag Manager -->
  <script>
    (function (w, d, s, l, i) {
      w[l] = w[l] || [];
      w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
      var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
      j.async = true;
      j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
      f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-NFJTSQ3N");
  </script>
  <!-- End Google Tag Manager -->

  <!-- GLOBAL STYLES & LIBS -->
  <link rel="stylesheet" href="../../styles/styles.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script type="module" src="../../styles/theme.js"></script>
  <script type="module" src="../../layout.js"></script>

  <!-- THEME INIT -->
  <script>
    document.documentElement.setAttribute(
      "data-theme",
      localStorage.getItem("theme") || "dark"
    );
  </script>

  <!-- RSA TOOL EXTRA CSS (MERGED/OPTIMISED) -->
  <style>
    /* ------- GENERAL UTILS ------- */
    .btn {
      @apply inline-flex items-center justify-center gap-2 rounded font-medium text-sm px-4 py-2 transition border border-transparent whitespace-nowrap; }
    .btn-primary { @apply bg-primary text-primary-foreground hover:bg-primary/90; }
    .btn-secondary { @apply bg-secondary text-secondary-foreground hover:bg-secondary/80; }
    .btn-destructive { @apply bg-destructive text-destructive-foreground hover:bg-destructive/90; }

    .card { @apply bg-card border border-border rounded shadow-sm; }
    .input { @apply w-full bg-background border border-input rounded px-4 py-3 text-sm text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring/30 focus:border-ring; }
    .char-counter { @apply text-xs text-muted-foreground text-right font-medium mt-1; }

    /* ------- HEADER ------- */
    .header {
      background: linear-gradient(135deg, oklch(var(--primary)) 0%, oklch(var(--primary)/0.8) 100%);
      color: oklch(var(--primary-foreground));
      padding: var(--space-12) var(--space-8) var(--space-8);
      position: relative;
    }
    .header::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, oklch(var(--primary)/0.1) 0%, oklch(var(--accent)/0.1) 100%);
      pointer-events: none;
    }

    /* ------- PREVIEW ELEMENTS ------- */
    .preview-tab { @apply bg-transparent text-muted-foreground flex-1 rounded-md py-2 px-4 cursor-pointer font-medium text-sm transition; border:none; }
    .preview-tab.active { @apply bg-background text-foreground shadow; }

    .ad-preview-row { position:relative; display:flex; gap:var(--space-6); align-items:flex-start; }
    .ad-preview-text { flex:1; min-width:0; padding-right:calc(72px + var(--space-6)); }
    .ad-image { width:72px; height:72px; object-fit:cover; background:oklch(var(--muted)); border:1.5px solid oklch(var(--border)); border-radius:12px; position:absolute; top:0; right:0; }
    @media(max-width:768px){ .ad-preview-row{flex-direction:column; padding-right:0;} .ad-image{position:static; width:100%; height:180px; border-radius:16px; margin-bottom:var(--space-4);} }

    /* mimic Google ads appearance */
    .ad-sponsored-row { font-size:0.875rem; color:#4d5156; margin-bottom:0.25rem; display:flex; gap:0.25rem; align-items:center; }
    .ad-sponsored-row span:first-child { color:#202124; font-weight:600; }
    .ad-sponsored-row span:nth-child(3) { color:#006621; }
    .ad-title { font-size:1.125rem; line-height:1.3; font-weight:400; }
    .ad-title a { color:#1a0dab; text-decoration:none; }
    .ad-title a:hover { text-decoration:underline; }
    .ad-description { font-size:0.875rem; color:#4d5156; line-height:1.58; }
    .sitelink { display:block; margin-right:1.5rem; color:#1a0dab; font-size:0.875rem; text-decoration:none; }
    .sitelink:hover { text-decoration:underline; }
    .callouts, .structured-snippets, .call-extension { font-size:0.875rem; color:#4d5156; }
    .call-extension a { color:#1a0dab; text-decoration:none; }
    .call-extension a:hover { text-decoration:underline; }

    .validation-summary { @apply bg-muted border border-border rounded p-6 text-sm mt-6; }
    .validation-item { @apply flex items-center gap-2 mb-2; }
    .validation-icon { font-weight:600; }
    .validation-icon.valid { color:#10b981; }
    .validation-icon.invalid { color: hsl(var(--destructive)); }
    .validation-icon.warning { color:#f59e0b; }

  </style>
</head>
<body data-slug="google-ads-rsa-preview" class="bg-transparent min-h-screen flex flex-col">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NFJTSQ3N" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <!-- NAVBAR -->
  <nav class="bg-background shadow-md border-b border-border">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center gap-4">
          <button id="sidebar-toggle" class="btn btn-outline btn-sm" aria-label="Open sidebar"><i class="fas fa-bars"></i></button>
          <a href="../../index.html" class="flex items-center gap-2"><span class="text-foreground text-xl font-bold">reformately</span></a>
        </div>
        <div class="flex items-center gap-2"><button id="theme-toggle" class="btn btn-outline btn-sm" aria-label="Toggle theme"><span id="theme-toggle-icon">üåô</span></button></div>
      </div>
    </div>
  </nav>

  <!-- SIDEBAR -->
  <div class="flex flex-grow">
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 hidden z-30"></div>
    <aside id="sidebar" class="fixed inset-y-0 left-0 w-64 bg-background border-r border-border/20 p-4 transform -translate-x-full transition-transform z-40 overflow-y-auto overscroll-contain">
      <div class="flex justify-between items-center mb-4">
        <span class="text-xl font-bold text-foreground">reformately</span>
        <button id="sidebar-close" class="btn btn-outline btn-sm" aria-label="Close sidebar"><i class="fas fa-times"></i></button>
      </div>
      <input id="tool-search" type="text" placeholder="Search" class="input mb-4" />
      <ul id="tool-list" class="space-y-2 text-foreground text-sm">
        <li><a href="../image-converter/index.html" class="hover:text-primary">Image Converter</a></li>
        <li><a href="../background-remover/index.html" class="hover:text-primary">Background Remover</a></li>
        <li><a href="../google-ads-rsa-preview/index.html" class="hover:text-primary">Google Ads RSA Preview</a></li>
        <li><a href="../campaign-structure/index.html" class="hover:text-primary">Campaign Structure</a></li>
        <li><a href="../bulk-match-editor/index.html" class="hover:text-primary">Bulk Match Type Editor</a></li>
        <li><a href="../json-formatter/index.html" class="hover:text-primary">JSON Formatter</a></li>
        <li><a href="../color-palette/index.html" class="hover:text-primary">Colour Palette Extractor</a></li>
        <li><a href="../pdf-merger/index.html" class="hover:text-primary">PDF Merger</a></li>
        <li><a href="../pdf-ocr/index.html" class="hover:text-primary">PDF OCR</a></li>
        <li><a href="../meta-tag-generator/index.html" class="hover:text-primary">Meta Tag Generator</a></li>
        <li><a href="../layout-tool/index.html" class="hover:text-primary">Layout Generator</a></li>
        <li><a href="#" class="hover:text-primary">More coming soon</a></li>
      </ul>
      <div class="mt-6 pt-6 border-t border-border/20"><a href="../request-tool/index.html" class="text-foreground hover:text-primary">Request a Tool</a></div>
    </aside>

    <!-- MAIN CONTENT -->
    <main id="main-content" class="flex-grow p-4">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- HEADER -->
        <header class="header text-center rounded-lg mb-8">
          <h1 class="text-3xl font-bold mb-4">Google Ads RSA Comprehensive Preview Tool</h1>
          <p class="opacity-90">Simulate and preview your Responsive Search Ads with all major features and extensions.</p>
        </header>

        <!-- GRID -->
        <div class="grid lg:grid-cols-2 gap-8">

          <!-- FORM COLUMN -->
          <section class="card p-6 space-y-8" id="form-column">
            <!-- Final URL / Display URL -->
            <div class="space-y-6">
              <div>
                <label class="block text-sm font-medium mb-2">Final URL</label>
                <input id="finalUrl" type="url" class="input" placeholder="https://example.com" value="https://example.com" />
              </div>
              <div>
                <label class="block text-sm font-medium mb-2">Display URL</label>
                <input id="displayUrl" type="text" class="input" placeholder="example.com" value="example.com" />
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-2">Path 1</label>
                  <input id="path1" type="text" class="input" maxlength="15" placeholder="e.g. shoes" />
                  <div class="char-counter" id="path1-counter">0 / 15</div>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">Path 2</label>
                  <input id="path2" type="text" class="input" maxlength="15" placeholder="e.g. men" />
                  <div class="char-counter" id="path2-counter">0 / 15</div>
                </div>
              </div>
            </div>

            <hr class="border-border" />

            <!-- Headlines -->
            <div>
              <div class="flex items-center justify-between mb-4"><h2 class="text-lg font-semibold">Headlines <span class="text-xs font-normal text-muted-foreground">(up to 15)</span></h2><button id="add-headline" class="btn btn-primary btn-sm">+ Add Headline</button></div>
              <div id="headlines-container"></div>
            </div>

            <hr class="border-border" />

            <!-- Descriptions -->
            <div>
              <div class="flex items-center justify-between mb-4"><h2 class="text-lg font-semibold">Descriptions <span class="text-xs font-normal text-muted-foreground">(up to 4)</span></h2><button id="add-description" class="btn btn-primary btn-sm">+ Add Description</button></div>
              <div id="descriptions-container"></div>
            </div>

            <hr class="border-border" />

            <!-- Sitelinks -->
            <div>
              <div class="flex items-center justify-between mb-4"><h2 class="text-lg font-semibold">Sitelinks <span class="text-xs font-normal text-muted-foreground">(up to 4)</span></h2><button id="add-sitelink" class="btn btn-primary btn-sm">+ Add Sitelink</button></div>
              <div id="sitelinks-container"></div>
            </div>

            <hr class="border-border" />

            <!-- Callouts -->
            <div>
              <div class="flex items-center justify-between mb-4"><h2 class="text-lg font-semibold">Callout Extensions <span class="text-xs font-normal text-muted-foreground">(up to 4)</span></h2><button id="add-callout" class="btn btn-primary btn-sm">+ Add Callout</button></div>
              <div id="callouts-container"></div>
            </div>

            <hr class="border-border" />

            <!-- Structured Snippets -->
            <div>
              <div class="flex items-center justify-between mb-4"><h2 class="text-lg font-semibold">Structured Snippets <span class="text-xs font-normal text-muted-foreground">(2 headers, 10 values ea.)</span></h2><button id="add-snippet" class="btn btn-primary btn-sm">+ Add Structured Snippet</button></div>
              <div id="snippets-container"></div>
            </div>

            <hr class="border-border" />

            <!-- Image Asset -->
            <div>
              <h2 class="text-lg font-semibold mb-4">Image Asset <span class="text-xs font-normal text-muted-foreground">(1:1 or 1.91:1)</span></h2>
              <input id="imageAsset" type="file" class="input" accept="image/png, image/jpeg" />
              <div class="text-xs text-muted-foreground mt-1" id="imageAsset-info">No image uploaded</div>
            </div>

            <hr class="border-border" />

            <!-- Call Extension -->
            <div>
              <h2 class="text-lg font-semibold mb-4">Call Extension</h2>
              <input id="callExtension" type="tel" class="input" maxlength="20" placeholder="e.g. +1-555-123-4567" />
            </div>
          </section>

          <!-- PREVIEW COLUMN -->
          <section class="card p-6 space-y-6" id="preview-column">
            <h2 class="text-lg font-semibold">Ad Preview</h2>
            <div class="flex bg-muted p-1 rounded-md">
              <button id="desktop-tab" class="preview-tab active">Desktop</button>
              <button id="mobile-tab" class="preview-tab">Mobile</button>
            </div>
            <div id="ad-preview" class="border border-border rounded-lg p-6 bg-background min-h-[200px]"></div>
            <div id="validation-summary" class="validation-summary"></div>
            <div id="ad-strength" class="font-semibold"></div>
          </section>
        </div>

        <!-- ABOUT / FAQ -->
        <section class="max-w-2xl mx-auto mt-16 space-y-6 text-foreground">
          <h2 class="text-2xl font-bold">About this tool</h2>
          <p>Use the RSA preview to craft your responsive search ads before launching them in Google Ads. Test different headlines, descriptions, and assets to ensure everything fits Google‚Äôs guidelines.</p>
          <h3 class="text-xl font-semibold">FAQs</h3>
          <details class="border p-3 rounded-md"><summary class="cursor-pointer font-semibold">Why preview RSAs?</summary><p class="mt-2">Previewing ads helps you verify character counts and extensions so your final ad looks polished when it serves.</p></details>
          <details class="border p-3 rounded-md"><summary class="cursor-pointer font-semibold">Does this create the ad in Google Ads?</summary><p class="mt-2">No. This tool only simulates the look and validates text length. You‚Äôll still create the ad in your Google Ads account.</p></details>
        </section>
      </div>
    </main>
  </div>

  <!-- FOOTER -->
  <footer class="bg-background border-t border-border mt-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 text-center text-foreground/70">¬© 2024 reformately. All rights reserved.</div>
  </footer>

  <!-- ================= JS LOGIC ================= -->
  <script>
    /* ---------------- CONSTANTS ---------------- */
    const MAX_HEADLINES=15, MAX_DESCRIPTIONS=4, MAX_SITELINKS=4, MAX_CALLOUTS=4, MAX_SNIPPETS=2, MAX_SNIPPET_VALUES=10;
    const HEADLINE_LIMIT=30, DESCRIPTION_LIMIT=90, SITELINK_LIMIT=25, CALLOUT_LIMIT=25, SNIPPET_HEADER_LIMIT=25, SNIPPET_VALUE_LIMIT=25;

    /* ---------------- HELPERS ---------------- */
    const q=(sel,parent=document)=>parent.querySelector(sel);
    const qa=(sel,parent=document)=>Array.from(parent.querySelectorAll(sel));
    function createInput(type,val,ph,max){ const el=document.createElement(type==='textarea'?'textarea':'input'); if(type!=='textarea') el.type=type; el.value=val||''; el.placeholder=ph||''; if(max) el.maxLength=max; el.className='input'; return el; }
    function createCounter(limit){ const d=document.createElement('div'); d.className='char-counter'; d.textContent=`0 / ${limit}`; return d; }
    function setCounter(inp,cnt,limit){ cnt.textContent=`${inp.value.length} / ${limit}`; cnt.style.color=inp.value.length>limit?'hsl(var(--destructive))':'var(--muted-foreground)'; }
    function dynamic(text){ return text.replace(/\{Countdown\(([^)]+)\)\}/gi,(_,date)=>{const t=new Date(date); if(isNaN(t)) return ''; const diff=Math.ceil((t-new Date())/864e5); return diff>0?diff+' days':'0 days';}).replace(/\{Keyword:([^}]+)\}/gi,(_,d)=>d);}  

    let imageAssetDataUrl='';

    /* ---------------- FIELD BUILDERS ---------------- */
    function addHeadline(v=''){ const cont=q('#headlines-container'); if(cont.children.length>=MAX_HEADLINES) return; const wrap=document.createElement('div'); wrap.className='mb-4'; const lbl=document.createElement('label'); lbl.className='block text-sm font-medium mb-2'; lbl.textContent=`Headline ${cont.children.length+1}`; const inp=createInput('text',v,`Headline`,HEADLINE_LIMIT); const cnt=createCounter(HEADLINE_LIMIT); inp.oninput=()=>{ setCounter(inp,cnt,HEADLINE_LIMIT); render(); validate(); }; setCounter(inp,cnt,HEADLINE_LIMIT); wrap.append(lbl,inp,cnt); if(cont.children.length>2){ const rem=document.createElement('button'); rem.className='btn btn-destructive btn-sm mt-1'; rem.textContent='Remove'; rem.onclick=e=>{e.preventDefault(); wrap.remove(); render(); validate();}; wrap.append(rem);} cont.append(wrap);}  
    function addDescription(v=''){ const cont=q('#descriptions-container'); if(cont.children.length>=MAX_DESCRIPTIONS) return; const wrap=document.createElement('div'); wrap.className='mb-4'; const lbl=document.createElement('label'); lbl.className='block text-sm font-medium mb-2'; lbl.textContent=`Description ${cont.children.length+1}`; const inp=createInput('textarea',v,'Description',DESCRIPTION_LIMIT); inp.rows=2; const cnt=createCounter(DESCRIPTION_LIMIT); inp.oninput=()=>{ setCounter(inp,cnt,DESCRIPTION_LIMIT); render(); validate(); }; setCounter(inp,cnt,DESCRIPTION_LIMIT); wrap.append(lbl,inp,cnt); if(cont.children.length>1){ const rem=document.createElement('button'); rem.className='btn btn-destructive btn-sm mt-1'; rem.textContent='Remove'; rem.onclick=e=>{e.preventDefault(); wrap.remove(); render(); validate();}; wrap.append(rem);} cont.append(wrap);}  

    function addSitelink(obj={text:'',url:'',desc1:'',desc2:''}){ const cont=q('#sitelinks-container'); if(cont.children.length>=MAX_SITELINKS) return; const wrap=document.createElement('div'); wrap.className='mb-4 space-y-2'; const lbl=document.createElement('label'); lbl.className='block font-medium'; lbl.textContent=`Sitelink ${cont.children.length+1}`; const txt=createInput('text',obj.text,'Text',SITELINK_LIMIT); const url=createInput('text',obj.url,'URL',1024); const d1=createInput('text',obj.desc1,'Description 1',SITELINK_LIMIT); const d2=createInput('text',obj.desc2,'Description 2',SITELINK_LIMIT); const cnt=createCounter(SITELINK_LIMIT); txt.oninput=()=>{ setCounter(txt,cnt,SITELINK_LIMIT); render(); validate(); }; setCounter(txt,cnt,SITELINK_LIMIT); wrap.append(lbl,txt,cnt,url,d1,d2); if(cont.children.length>0){ const rem=document.createElement('button'); rem.className='btn btn-destructive btn-sm'; rem.textContent='Remove'; rem.onclick=e=>{e.preventDefault(); wrap.remove(); render(); validate();}; wrap.append(rem);} cont.append(wrap);}  

    function addCallout(v=''){ const cont=q('#callouts-container'); if(cont.children.length>=MAX_CALLOUTS) return; const wrap=document.createElement('div'); wrap.className='mb-4'; const lbl=document.createElement('label'); lbl.className='block font-medium mb-1'; lbl.textContent=`Callout ${cont.children.length+1}`; const inp=createInput('text',v,'Callout',CALLOUT_LIMIT); const cnt=createCounter(CALLOUT_LIMIT); inp.oninput=()=>{ setCounter(inp,cnt,CALLOUT_LIMIT); render(); validate(); }; setCounter(inp,cnt,CALLOUT_LIMIT); wrap.append(lbl,inp,cnt); if(cont.children.length>0){ const rem=document.createElement('button'); rem.className='btn btn-destructive btn-sm mt-1'; rem.textContent='Remove'; rem.onclick=e=>{e.preventDefault(); wrap.remove(); render(); validate();}; wrap.append(rem);} cont.append(wrap);}  

    function addSnippet(obj={header:'',values:[]}){ const cont=q('#snippets-container'); if(cont.children.length>=MAX_SNIPPETS) return; const wrap=document.createElement('div'); wrap.className='mb-4 space-y-2'; const lbl=document.createElement('label'); lbl.className='block font-medium'; lbl.textContent=`Snippet ${cont.children.length+1} Header`; const header=createInput('text',obj.header,'Header',SNIPPET_HEADER_LIMIT); const hc=createCounter(SNIPPET_HEADER_LIMIT); header.oninput=()=>{ setCounter(header,hc,SNIPPET_HEADER_LIMIT); render(); validate(); }; setCounter(header,hc,SNIPPET_HEADER_LIMIT); const valuesDiv=document.createElement('div'); valuesDiv.className='space-y-2'; function addVal(v=''){ if(valuesDiv.children.length>=MAX_SNIPPET_VALUES) return; const row=document.createElement('div'); row.className='flex items-center gap-2'; const inp=createInput('text',v,'Value',SNIPPET_VALUE_LIMIT); const cnt=createCounter(SNIPPET_VALUE_LIMIT); inp.oninput=()=>{ setCounter(inp,cnt,SNIPPET_VALUE_LIMIT); render(); validate(); }; setCounter(inp,cnt,SNIPPET_VALUE_LIMIT); row.append(inp,cnt); if(valuesDiv.children.length>0){ const rm=document.createElement('button'); rm.className='btn btn-destructive btn-sm'; rm.textContent='Remove'; rm.onclick=e=>{e.preventDefault(); row.remove(); render(); validate();}; row.append(rm);} valuesDiv.append(row);}  (obj.values.length?obj.values:['']).forEach(addVal);
      const addValBtn=document.createElement('button'); addValBtn.className='btn btn-secondary btn-sm'; addValBtn.textContent='+ Add Value'; addValBtn.onclick=e=>{e.preventDefault(); addVal();};
      wrap.append(lbl,header,hc,valuesDiv,addValBtn); if(cont.children.length>0){ const rem=document.createElement('button'); rem.className='btn btn-destructive btn-sm'; rem.textContent='Remove'; rem.onclick=e=>{e.preventDefault(); wrap.remove(); render(); validate();}; wrap.append(rem);} cont.append(wrap);}  

    /* ---------------- INIT ---------------- */
    document.addEventListener('DOMContentLoaded',()=>{
      // default fields
      [...Array(3)].forEach(()=>addHeadline()); [...Array(2)].forEach(()=>addDescription()); addSitelink(); addCallout(); addSnippet();

      // add-btn listeners
      q('#add-headline').onclick=e=>{e.preventDefault(); addHeadline(); render(); validate();};
      q('#add-description').onclick=e=>{e.preventDefault(); addDescription(); render(); validate();};
      q('#add-sitelink').onclick=e=>{e.preventDefault(); addSitelink(); render(); validate();};
      q('#add-callout').onclick=e=>{e.preventDefault(); addCallout(); render(); validate();};
      q('#add-snippet').onclick=e=>{e.preventDefault(); addSnippet(); render(); validate();};

      // basic inputs
      ['finalUrl','displayUrl','path1','path2','callExtension'].forEach(id=>q('#'+id).oninput=()=>{if(id.includes('path')) setCounter(q('#'+id), q('#'+id+'-counter'),15); render(); validate();});

      // image upload
      const img=q('#imageAsset'), info=q('#imageAsset-info'); img.onchange=e=>{ const file=e.target.files[0]; if(file){ const r=new FileReader(); r.onload=ev=>{ imageAssetDataUrl=ev.target.result; info.textContent=`${file.name} (${Math.round(file.size/1024)} KB)`; render(); }; r.readAsDataURL(file);} else { imageAssetDataUrl=''; info.textContent='No image uploaded'; render(); }};

      // tabs
      q('#desktop-tab').onclick=()=>{q('#desktop-tab').classList.add('active'); q('#mobile-tab').classList.remove('active'); render('desktop');};
      q('#mobile-tab').onclick=()=>{q('#mobile-tab').classList.add('active'); q('#desktop-tab').classList.remove('active'); render('mobile');};

      render(); validate();
    });

    /* ---------------- RENDER PREVIEW ---------------- */
    function render(mode){ const mobile=mode==='mobile'||q('#mobile-tab').classList.contains('active');
      const finalUrl=q('#finalUrl').value||'https://example.com'; const displayUrl=q('#displayUrl').value||'example.com'; const p1=q('#path1').value; const p2=q('#path2').value;

      // collect headlines
      const heads=qa('#headlines-container input').map(i=>i.value.trim()).filter(Boolean).map(dynamic);
      const descs=qa('#descriptions-container textarea').map(i=>i.value.trim()).filter(Boolean).map(dynamic);
      const sitelinks=qa('#sitelinks-container > div').map(g=>{const f=qa('input',g); return{ text:f[0].value,url:f[1].value,desc1:f[2].value,desc2:f[3].value};}).filter(s=>s.text);
      const callouts=qa('#callouts-container input').map(i=>i.value.trim()).filter(Boolean);
      const snippets=qa('#snippets-container > div').map(g=>{const header=q('input',g).value; const values=qa('.snippet-values input',g).map(i=>i.value.trim()).filter(Boolean); return{header,values};}).filter(s=>s.header&&s.values.length);
      const phone=q('#callExtension').value.trim();

      let html=`<div class="ad-sponsored-row"><span>Sponsored</span><span class="ad-sponsored-dot">‚Ä¢</span><span>${displayUrl}${p1?'/'+p1:''}${p2?'/'+p2:''}</span></div>`;
      html+='<div class="ad-preview-row">';
      if(mobile){ html+=imageAssetDataUrl?`<img class="ad-image" src="${imageAssetDataUrl}" alt="ad">`:`<div class="ad-image flex items-center justify-center text-4xl text-muted-foreground">üñºÔ∏è</div>`; }
      html+='<div class="ad-preview-text">';
      const title=heads.slice(0,3).join(' | ');
      html+=`<div class="ad-title">${title?`<a href="${finalUrl}" target="_blank">${title}</a>`:'<span class="text-muted-foreground">Your ad title...</span>'}</div>`;
      html+=`<div class="ad-description mt-1">${descs.slice(0,2).join(' ')||'<span class="text-muted-foreground">Your ad description...</span>'}</div>`;
      html+='<div class="ad-extensions mt-2">';
      if(sitelinks.length){ html+='<div class="sitelinks flex flex-wrap gap-x-6 gap-y-1 mt-2">'+sitelinks.map(s=>`<a class="sitelink" href="${s.url||finalUrl}" target="_blank">${s.text}</a>`).join('')+'</div>'; }
      if(callouts.length){ html+='<div class="callouts flex flex-wrap gap-3 mt-2">'+callouts.map(c=>`<span class="callout">${c}</span>`).join('')+'</div>'; }
      if(snippets.length){ html+='<div class="structured-snippets flex flex-wrap gap-3 mt-2">'+snippets.map(sn=>`<span class="structured-snippet"><b>${sn.header}:</b> ${sn.values.join(', ')}</span>`).join('')+'</div>'; }
      if(phone){ html+=`<div class="call-extension mt-2">Call: <a href="tel:${phone}">${phone}</a></div>`; }
      html+='</div>'; // text
      if(!mobile){ html+=imageAssetDataUrl?`<img class="ad-image" src="${imageAssetDataUrl}" alt="ad">`:`<div class="ad-image flex items-center justify-center text-4xl text-muted-foreground">üñºÔ∏è</div>`; }
      html+='</div>'; // row
      q('#ad-preview').innerHTML=html;
      adStrength(heads,descs);
    }

    /* ---------------- VALIDATION ---------------- */
    function validate(){ const list=[];
      const heads=qa('#headlines-container input'); const filledH=heads.filter(i=>i.value.trim()); if(filledH.length<3) list.push({t:'At least 3 headlines recommended.',i:'warning'}); else list.push({t:`${filledH.length} headlines added.`,i:'valid'}); heads.forEach((h,i)=>{ if(h.value.length>HEADLINE_LIMIT) list.push({t:`Headline ${i+1} exceeds ${HEADLINE_LIMIT} chars.`,i:'invalid'});});
      const descs=qa('#descriptions-container textarea'); const filledD=descs.filter(i=>i.value.trim()); if(filledD.length<2) list.push({t:'At least 2 descriptions recommended.',i:'warning'}); else list.push({t:`${filledD.length} descriptions added.`,i:'valid'}); descs.forEach((d,i)=>{ if(d.value.length>DESCRIPTION_LIMIT) list.push({t:`Description ${i+1} exceeds ${DESCRIPTION_LIMIT} chars.`,i:'invalid'});});
      qa('#sitelinks-container input:nth-child(2)').forEach((s,i)=>{ if(s.value.length>SITELINK_LIMIT) list.push({t:`Sitelink ${i+1} exceeds ${SITELINK_LIMIT} chars.`,i:'invalid'});});
      qa('#callouts-container input').forEach((c,i)=>{ if(c.value.length>CALLOUT_LIMIT) list.push({t:`Callout ${i+1} exceeds ${CALLOUT_LIMIT} chars.`,i:'invalid'});});
      qa('#snippets-container > div').forEach((g,i)=>{ const h=q('input',g); if(h.value.length>SNIPPET_HEADER_LIMIT) list.push({t:`Snippet header ${i+1} exceeds ${SNIPPET_HEADER_LIMIT} chars.`,i:'invalid'}); qa('.snippet-values input',g).forEach((v,j)=>{ if(v.value.length>SNIPPET_VALUE_LIMIT) list.push({t:`Snippet value ${j+1} in header ${i+1} exceeds ${SNIPPET_VALUE_LIMIT} chars.`,i:'invalid'});}); });
      const p1=q('#path1').value, p2=q('#path2').value; if(p1.length>15) list.push({t:'Path 1 exceeds 15 chars.',i:'invalid'}); if(p2.length>15) list.push({t:'Path 2 exceeds 15 chars.',i:'invalid'});
      if(!q('#finalUrl').value.trim()) list.push({t:'Final URL is required.',i:'invalid'}); if(!q('#displayUrl').value.trim()) list.push({t:'Display URL is required.',i:'invalid'});
      const phone=q('#callExtension').value.trim(); if(phone && !/^\+?[\d\s()\-]+$/.test(phone)) list.push({t:'Phone format invalid.',i:'invalid'});
      q('#validation-summary').innerHTML=list.length?list.map(v=>`<div class="validation-item"><span class="validation-icon ${v.i}">${v.i==='valid'?'‚úì':v.i==='invalid'?'‚úó':'‚ö†'}</span>${v.t}</div>`).join(''):`<div class="validation-item"><span class="validation-icon valid">‚úì</span>Ready to preview</div>`;
    }

    /* ---------------- AD STRENGTH ---------------- */
    function adStrength(heads,descs){ const set=new Set([...heads,...descs]); let rating='poor'; if(set.size>=15) rating='excellent'; else if(set.size>=10) rating='good'; else if(set.size>=5) rating='average'; const el=q('#ad-strength'); el.textContent=`Ad Strength: ${rating[0].toUpperCase()+rating.slice(1)}`; el.className=`ad-strength ${rating}`; }
  </script>
</body>
</html>